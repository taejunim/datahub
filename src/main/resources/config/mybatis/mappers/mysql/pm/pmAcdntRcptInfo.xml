<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.pm.mapper.PmAcdntRcptInfoMapper">
    <select id="countPmAcdntRcptInfoListByFilter" parameterType="pmAcdntRcptInfoRequestDto" resultType="java.lang.Integer">
        SELECT
            COUNT( * )
        FROM pm_acdnt_rcpt_info
        <where>
            1=1
            <if test="accType != null and accType != ''">
                AND acdnt_type = #{accType}
            </if>
            <if test="pmKind != 'all'">
                <choose>
                    <when test="pmKind != null and pmKind != ''">
                        AND pm_type = #{pmKind}
                    </when>
                    <otherwise>
                        AND pm_type is null
                    </otherwise>
                </choose>
            </if>
            <if test="gender != null and gender != ''">
                AND sexd = #{gender}
            </if>
            <if test="company != null and company != ''">
                <choose>
                    <when test="company == 'none'">
                        AND oper_co is null
                    </when>
                    <otherwise>
                        AND oper_co = #{company}
                    </otherwise>
                </choose>
            </if>
            <if test="location != 'all'">
                <choose>
                    <when test="location != null and location != ''">
                        AND acdnt_spot = #{location}
                    </when>
                    <otherwise>
                        AND acdnt_spot is null
                    </otherwise>
                </choose>
            </if>
            <if test="age != null">
                <choose>
                    <when test="age == 1">
                        AND (age = '-' OR age IS NULL)
                    </when>
                    <when test="age &lt; 50">
                        AND CAST(age AS INT) BETWEEN #{age} AND #{age} + 9
                    </when>
                    <otherwise>
                        AND CAST(age AS INT) >= #{age}
                    </otherwise>
                </choose>
            </if>
            <if test="startSearchDt != null and endSearchDt != null">
                AND acdnt_ocrn_dt BETWEEN #{startSearchDt} AND #{endSearchDt}
            </if>
        </where>
    </select>

    <select id="selectPmAcdntRcptInfoListByFilter" parameterType="pmAcdntRcptInfoRequestDto" resultType="pmAcdntRcptInfo">
        SELECT
               a.id
             , a.dat_st_id
             , a.oper_co
             , a.pm_type
             , a.sexd
             , a.age
             , a.acdnt_ocrn_dt
             , a.acdnt_ocrn_plc
             , a.acdnt_type
             , a.acdnt_cn
             , a.acdnt_x
             , a.acdnt_y
             , a.acdnt_spot
        FROM pm_acdnt_rcpt_info AS a
        <where>
            1=1
            <if test="accType != null and accType != ''">
                AND acdnt_type = #{accType}
            </if>
            <if test="pmKind != 'all'">
                <choose>
                    <when test="pmKind != null and pmKind != ''">
                        AND pm_type = #{pmKind}
                    </when>
                    <otherwise>
                        AND pm_type is null
                    </otherwise>
                </choose>
            </if>
            <if test="gender != null and gender != ''">
                AND sexd = #{gender}
            </if>
            <if test="company != null and company != ''">
                <choose>
                    <when test="company == 'none'">
                        AND oper_co is null
                    </when>
                    <otherwise>
                        AND oper_co = #{company}
                    </otherwise>
                </choose>
            </if>
            <if test="location != 'all'">
                <choose>
                    <when test="location != null and location != ''">
                        AND acdnt_spot = #{location}
                    </when>
                    <otherwise>
                        AND acdnt_spot is null
                    </otherwise>
                </choose>
            </if>
            <if test="age != null">
                <choose>
                    <when test="age == 1">
                        AND (age = '-' OR age IS NULL)
                    </when>
                    <when test="age &lt; 50">
                        AND CAST(age AS INT) BETWEEN #{age} AND #{age} + 9
                    </when>
                    <otherwise>
                        AND CAST(age AS INT) >= #{age}
                    </otherwise>
                </choose>
            </if>
            <if test="startSearchDt != null and endSearchDt != null">
                AND acdnt_ocrn_dt BETWEEN #{startSearchDt} AND #{endSearchDt}
            </if>
        </where>
        <if test="null!=sort and null!=sortOrd"> order by ${sort} ${sortOrd} </if>
        <if test="pagingYn == true and start != null and length != null" >
            limit #{start}, #{length}
        </if>
    </select>

    <select id="selectGraphPmAcdntRcptInfoListByFilter" parameterType="pmAcdntRcptInfoRequestDto" resultType="pmAcdntRcptInfo">
        SELECT
        a.id
        , a.dat_st_id
        , a.oper_co
        , a.pm_type
        , a.sexd
        , a.age
        , a.acdnt_ocrn_dt
        , a.acdnt_ocrn_plc
        , a.acdnt_type
        , a.acdnt_cn
        , a.acdnt_x
        , a.acdnt_y
        , a.acdnt_spot
        FROM pm_acdnt_rcpt_info AS a
        <where>
            1=1
            <if test="accType != null and accType != ''">
                AND acdnt_type = #{accType}
            </if>
            <if test="pmKind != null and pmKind != ''">
                AND pm_type = #{pmKind}
            </if>
            <if test="gender != null and gender != ''">
                AND sexd = #{gender}
            </if>
            <if test="company != null and company != ''">
                <choose>
                    <when test="company == 'none'">
                        AND oper_co is null
                    </when>
                    <otherwise>
                        AND oper_co = #{company}
                    </otherwise>
                </choose>
            </if>
            <if test="location != null and location != ''">
                AND acdnt_spot = #{location}
            </if>
            <if test="age != null">
                <choose>
                    <when test="age == 1">
                        AND (age = '-' OR age IS NULL)
                    </when>
                    <when test="age &lt; 50">
                        AND CAST(age AS INT) BETWEEN #{age} AND #{age} + 9
                    </when>
                    <otherwise>
                        AND CAST(age AS INT) >= #{age}
                    </otherwise>
                </choose>
            </if>
            <if test="startSearchDt != null and endSearchDt != null">
                AND acdnt_ocrn_dt BETWEEN #{startSearchDt} AND #{endSearchDt}
            </if>
        </where>
    </select>

    <select id="selectPmAcdntRcptInfoList" parameterType="pmAcdntRcptInfo" resultType="pmAcdntRcptInfo">
        SELECT
               a.id
             , a.dat_st_id
             , a.oper_co
             , a.pm_type
             , a.sexd
             , a.age
             , a.acdnt_ocrn_dt
             , a.acdnt_ocrn_plc
             , a.acdnt_type
             , a.acdnt_cn
             , a.acdnt_x
             , a.acdnt_y
             , a.acdnt_spot
        FROM pm_acdnt_rcpt_info AS a
    </select>

</mapper>